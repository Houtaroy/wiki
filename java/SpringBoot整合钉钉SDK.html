<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SpringBoot整合钉钉SDK | Houtaroy Wiki</title>
    <meta name="description" content="给时光以生命, 而不是给生命以时光">
    <link rel="stylesheet" href="/wiki/assets/style.5f10c5ca.css">
    <link rel="modulepreload" href="/wiki/assets/chunks/AlgoliaSearchBox.1f22568a.js">
    <link rel="modulepreload" href="/wiki/assets/app.7004e06b.js">
    <link rel="modulepreload" href="/wiki/assets/java_SpringBoot整合钉钉SDK.md.c26aa1a8.lean.js">
    
    <meta name="twitter:title" content="SpringBoot整合钉钉SDK | Houtaroy Wiki">
  <meta property="og:title" content="SpringBoot整合钉钉SDK | Houtaroy Wiki">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-2ba227d5><div class="sidebar-button" data-v-2ba227d5><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/wiki/" aria-label="Houtaroy Wiki, back to home" data-v-2ba227d5 data-v-b3da5816><!----> Houtaroy Wiki</a><div class="flex-grow" data-v-2ba227d5></div><div class="nav" data-v-2ba227d5><nav class="nav-links" data-v-2ba227d5 data-v-0fce24fe><!--[--><div class="item" data-v-0fce24fe><div class="nav-link" data-v-0fce24fe data-v-2cb643ba><a class="item active" href="/wiki/java/" data-v-2cb643ba>Java <!----></a></div></div><div class="item" data-v-0fce24fe><div class="nav-link" data-v-0fce24fe data-v-2cb643ba><a class="item" href="/wiki/training-record/micro-service" data-v-2cb643ba>培训记录 <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--[--><div class="algolia-search-box" id="docsearch"></div><!--]--><!--]--></header><aside class="sidebar" data-v-79af364c><nav class="nav-links nav" data-v-79af364c data-v-0fce24fe><!--[--><div class="item" data-v-0fce24fe><div class="nav-link" data-v-0fce24fe data-v-2cb643ba><a class="item active" href="/wiki/java/" data-v-2cb643ba>Java <!----></a></div></div><div class="item" data-v-0fce24fe><div class="nav-link" data-v-0fce24fe data-v-2cb643ba><a class="item" href="/wiki/training-record/micro-service" data-v-2cb643ba>培训记录 <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-79af364c><!--[--><li class="sidebar-link"><p class="sidebar-link-item">Java</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/wiki/java/">目录</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/wiki/java/开发手册">开发手册</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/wiki/java/使用Druid解析SQL查询语句">使用Druid解析SQL查询语句</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/wiki/java/SpringBoot整合钉钉SDK">SpringBoot整合钉钉SDK</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#_1-前言">1 前言</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_2-dingtalk-sdk">2 DingTalk SDK</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_3-spring-boot-整合-ding-talk-sdk">3 Spring Boot 整合 Ding Talk SDK</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#_3-总结">3 总结</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/wiki/java/SpringCloud分布式事务Seata">SpringCloud分布式事务Seata</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/wiki/java/SpringBoot整合Elasticsearch/">SpringBoot整合Elasticsearch</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-30e7de44><div class="container" data-v-30e7de44><!--[--><!--]--><div style="position:relative;" class="content" data-v-30e7de44><div><h1 id="springboot整合钉钉sdk" tabindex="-1">SpringBoot整合钉钉SDK <a class="header-anchor" href="#springboot整合钉钉sdk" aria-hidden="true">#</a></h1><h2 id="_1-前言" tabindex="-1">1 前言 <a class="header-anchor" href="#_1-前言" aria-hidden="true">#</a></h2><p>阅读本篇文章您可以了解到如下内容:</p><ul><li>DingTalk SDK</li><li>Spring Boot 整合 Ding Talk SDK</li></ul><p>在此之前, 如果您熟悉以下内容可更方便的进行理解:</p><ul><li>DingTalk 官方文档</li><li>模板方法模式</li></ul><h2 id="_2-dingtalk-sdk" tabindex="-1">2 DingTalk SDK <a class="header-anchor" href="#_2-dingtalk-sdk" aria-hidden="true">#</a></h2><p>身为Java开发者, 能看到钉钉官方提供的SDK还是十分高兴的</p><p>钉钉官方服务端接口有两个版本: 旧的和新的</p><p>二者的区别可以参考官方文档<a href="https://open.dingtalk.com/document/orgapp-server/differences-between-server-apis-and-new-server-apis" target="_blank" rel="noopener noreferrer">钉钉开放文档 (dingtalk.com)</a></p><p>简单总结一下:</p><ol><li>旧接口不会再发生变动</li><li>旧接口<strong>不会支持新API</strong></li><li>新接口会支持新API</li><li>新接口<strong>不支持部分旧API</strong>, 未来会全部支持</li></ol><p>介于这种情况, 当下我们在开发过程中, <strong>可能需要同时使用新旧两版SDK</strong></p><p>钉钉官方提供了一个很好用的接口工具: <a href="https://open-dev.dingtalk.com/apiExplorer?spm=ding_open_doc.document.0.0.702d722fEcr2Hb#/?devType=org&amp;api=oauth2_1.0%23CreateJsapiTicket" target="_blank" rel="noopener noreferrer">API Explorer (dingtalk.com)</a></p><p>笔者通过观察发现, 两版SDK的使用方式差别较大, 且需要开发人员手动维护Token</p><p>为了更快的方便公司兄弟们上手, 笔者借鉴了模板方法的一点技巧, 简单的对两个SDK进行包装</p><h2 id="_3-spring-boot-整合-ding-talk-sdk" tabindex="-1">3 Spring Boot 整合 Ding Talk SDK <a class="header-anchor" href="#_3-spring-boot-整合-ding-talk-sdk" aria-hidden="true">#</a></h2><p>在pom中引入SDK依赖:</p><div class="language-xml"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>alibaba-dingtalk-service-sdk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dingtalk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>首先创建钉钉开发所需要的配置参数类<code>DingTalkProperties</code>:</p><div class="language-java"><pre><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;ding-talk&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DingTalkProperties</span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token class-name">Long</span> agentId<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> appKey<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> appSecret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>创建模板方法类<code>DingTalkTemplate</code>:</p><div class="language-java"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DingTalkTemplate</span> <span class="token punctuation">{</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Config</span> NEW_SDK_DEFAULT_CONFIG<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">DingTalkProperties</span> properties<span class="token punctuation">;</span>

  <span class="token keyword">static</span> <span class="token punctuation">{</span>
    <span class="token class-name">Config</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>protocol <span class="token operator">=</span> <span class="token string">&quot;https&quot;</span><span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>regionId <span class="token operator">=</span> <span class="token string">&quot;central&quot;</span><span class="token punctuation">;</span>
    NEW_SDK_DEFAULT_CONFIG <span class="token operator">=</span> config<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token class-name">DingTalkTemplate</span><span class="token punctuation">(</span><span class="token class-name">DingTalkProperties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>properties <span class="token operator">=</span> properties<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过分析官网新版的SDK代码</p><p>可以归纳其流程为:</p><div class="language-mermaid"><pre><code><span class="token keyword">graph</span> LR
A<span class="token text string">(创建client)</span> <span class="token arrow operator">--&gt;</span> 构造请求 <span class="token arrow operator">--&gt;</span> 调用client相关方法 <span class="token arrow operator">--&gt;</span> D<span class="token text string">(解析响应结果)</span>
</code></pre></div><p>其中所有的client都是<code>com.aliyun.teaopenapi.Client</code>的子类</p><p>所以我们手动进行管理:</p><div class="language-java"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DingTalkTemplate</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...其它代码</span>
  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Client</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Client</span><span class="token punctuation">&gt;</span></span> newSdkClientMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * 获取新SDK客户端
   *
   * @param clientClass 客户端类型
   * @param &lt;T&gt;         客户类型
   * @return 新SDK客户端
   * @throws NoSuchClientException 未找到客户端异常
   */</span>
  <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Client</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getNewSdkClient</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clientClass<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchClientException</span> <span class="token punctuation">{</span>
    <span class="token class-name">T</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> newSdkClientMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>clientClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> clientClass<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>NEW_SDK_DEFAULT_CONFIG<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchClientException</span><span class="token punctuation">(</span>clientClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      newSdkClientMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>clientClass<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>参照官网新版的SDK代码, 我们在内存中对token进行维护:</p><div class="language-java"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DingTalkTemplate</span> <span class="token punctuation">{</span>

  <span class="token comment">// ...其它代码</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> TOKEN_RESERVED_MINUTES <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> accessToken<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> accessTokenExpirationTime<span class="token punctuation">;</span>

  <span class="token comment">/**
   * 获取accessToken
   *
   * @throws Exception 请求异常
   */</span>
  <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">accessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">GetAccessTokenResponseBody</span> body <span class="token operator">=</span> <span class="token function">oauth2AccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    accessToken <span class="token operator">=</span> body<span class="token punctuation">.</span><span class="token function">getAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    accessTokenExpirationTime <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">minusMinutes</span><span class="token punctuation">(</span>TOKEN_RESERVED_MINUTES<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">plusSeconds</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span><span class="token function">getExpireIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 获取accessToken
   *
   * @return token结果
   * @throws Exception 请求异常
   */</span>
  <span class="token keyword">public</span> <span class="token class-name">GetAccessTokenResponseBody</span> <span class="token function">oauth2AccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">oauth2AccessToken</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getAppKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> properties<span class="token punctuation">.</span><span class="token function">getAppSecret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 获取accessToken
   *
   * @param appKey    应用key
   * @param appSecret 应用密钥
   * @return token结果
   * @throws Exception 请求异常
   */</span>
  <span class="token keyword">public</span> <span class="token class-name">GetAccessTokenResponseBody</span> <span class="token function">oauth2AccessToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> appKey<span class="token punctuation">,</span> <span class="token class-name">String</span> appSecret<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>dingtalkoauth2_1_0<span class="token punctuation">.</span></span>Client</span> client <span class="token operator">=</span> <span class="token function">getNewSdkClient</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>dingtalkoauth2_1_0<span class="token punctuation">.</span></span>Client</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">GetAccessTokenRequest</span> getAccessTokenRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetAccessTokenRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAppKey</span><span class="token punctuation">(</span>appKey<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAppSecret</span><span class="token punctuation">(</span>appSecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> client<span class="token punctuation">.</span><span class="token function">getAccessToken</span><span class="token punctuation">(</span>getAccessTokenRequest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * token是否过期
   *
   * @return true 是 false 否
   */</span>
  <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isTokenExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> accessToken <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>accessToken<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAfter</span><span class="token punctuation">(</span>accessTokenExpirationTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>观察旧版SDK代码, 其流程与新版相似, 只是创建客户端的姿势不同</p><p>我们可以进一步包装:</p><div class="language-java"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DingTalkTemplate</span> <span class="token punctuation">{</span>

  <span class="token comment">// ...其它代码</span>
  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">DingTalkClient</span><span class="token punctuation">&gt;</span></span> clientMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * 获取请求客户端
   *
   * @param uri 请求资源路径
   * @return 请求客户端
   */</span>
  <span class="token keyword">public</span> <span class="token class-name">DingTalkClient</span> <span class="token function">getClient</span><span class="token punctuation">(</span><span class="token class-name">String</span> uri<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> clientMap<span class="token punctuation">.</span><span class="token function">computeIfAbsent</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token class-name">DefaultDingTalkClient</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 旧版SDK执行请求
   *
   * @param uri     请求资源路径
   * @param request 请求
   * @param &lt;T&gt;     响应结果类型
   * @return 响应结果
   * @throws Exception 请求异常
   */</span>
  <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">TaobaoResponse</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">String</span> uri<span class="token punctuation">,</span> <span class="token class-name">TaobaoRequest</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTokenExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">accessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">getClient</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_3-总结" tabindex="-1">3 总结 <a class="header-anchor" href="#_3-总结" aria-hidden="true">#</a></h2><p>有官方提供的SDK还是很香的</p><p>新版SDK更新频率很高(毕竟是低代码自动生成), 在使用时请持续关注</p></div></div><footer class="page-footer" data-v-30e7de44 data-v-504b1bfc><div class="edit" data-v-504b1bfc><div class="edit-link" data-v-504b1bfc data-v-40c300d5><!----></div></div><div class="updated" data-v-504b1bfc><!----></div></footer><div class="next-and-prev-link" data-v-30e7de44 data-v-0f10f042><div class="container" data-v-0f10f042><div class="prev" data-v-0f10f042><a class="link" href="/wiki/java/使用Druid解析SQL查询语句" data-v-0f10f042><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-0f10f042><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-0f10f042>使用Druid解析SQL查询语句</span></a></div><div class="next" data-v-0f10f042><a class="link" href="/wiki/java/SpringCloud分布式事务Seata" data-v-0f10f042><span class="text" data-v-0f10f042>SpringCloud分布式事务Seata</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-0f10f042><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"2646645b\",\"java_springboot整合elasticsearch_index.md\":\"7b633122\",\"java_springboot整合钉钉sdk.md\":\"c26aa1a8\",\"java_springcloud分布式事务seata.md\":\"03353e86\",\"java_index.md\":\"19a7e8a6\",\"java_使用druid解析sql查询语句.md\":\"fed2d013\",\"java_开发手册.md\":\"668b2141\",\"training-record_micro-service.md\":\"9034774f\"}")</script>
    <script type="module" async src="/wiki/assets/app.7004e06b.js"></script>
    
  </body>
</html>